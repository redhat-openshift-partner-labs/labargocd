apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: mhillsma-cluster

resources:
  - ../../cluster-templates/aws-ha/base

patches:
  # Install config secret (extracted to separate file)
  - path: patches/install-config.yaml

  # ClusterDeployment configuration
  - patch: |-
      apiVersion: hive.openshift.io/v1
      kind: ClusterDeployment
      metadata:
        name: cluster-placeholder
        namespace: cluster-placeholder
      spec:
        clusterName: mhillsma-cluster
        baseDomain: openshiftpartnerlabs.com
        platform:
          aws:
            region: us-east-1
        provisioning:
          imageSetRef:
            name: img4.20.10-x86-64-appsub
          installConfigSecretRef:
            name: cluster-placeholder-install-config
          sshPrivateKeySecretRef:
            name: mhillsma-cluster-ssh-key
          manifestsConfigMapRef: null

  # MachinePool configuration
  - patch: |-
      apiVersion: hive.openshift.io/v1
      kind: MachinePool
      metadata:
        name: cluster-placeholder-worker
        namespace: cluster-placeholder
      spec:
        clusterDeploymentRef:
          name: mhillsma-cluster
        replicas: 0
        platform:
          aws:
            type: m5.2xlarge

  # ManagedCluster configuration
  - patch: |-
      apiVersion: cluster.open-cluster-management.io/v1
      kind: ManagedCluster
      metadata:
        name: cluster-placeholder
        labels:
          environment: development

  # KlusterletAddonConfig configuration
  - patch: |-
      apiVersion: agent.open-cluster-management.io/v1
      kind: KlusterletAddonConfig
      metadata:
        name: cluster-placeholder
        namespace: cluster-placeholder
      spec:
        clusterName: mhillsma-cluster
        clusterNamespace: mhillsma-cluster
